<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="Assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="Assets/css/signin.css" />
    <title>Signup/Signin</title>
  </head>
  <body style="padding-top: 3.5rem">
    <nav class="nav navbar-expand-md fixed-top">
      <img src="Assets/images/google-meet-icon.png" class="logo" alt="" />
      <a href="#" class="navbar-brand text-dark">Clarity Call</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item">
            <a href="#" class="nav-link">At a glance</a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link">How it works</a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link">Plan and Price</a>
          </li>
        </ul>
        <ul class="navbar-nav mr-0">
          <li class="nav-item sign-in display-center">
            <a href="signin.html" class="nav-link">Sign in</a>
          </li>
          <li class="nav-item">
            <button
              class="btn btn-outline-secondary btn-lg text-info font-weight-bold join-meeting"
            >
              Join the meeting
            </button>
          </li>
          <li class="nav-item">
            <button
              class="btn btn-info btn-lg text-light font-weight-bold new-meeting"
            >
              Start a meeting
            </button>
          </li>
        </ul>
      </div>
    </nav>
      <div class="bg-image">
          <div id="signin-form" class="signin-modal w-50 d-flex flex-column align-items-center gap-3" style="font-family: 'Noto Sans', sans-serif; color: #4a4a4a;"> <!-- Bootstrap width and flex classes, inline styles for font and color -->
              <div class="px-5 py-2 d-flex flex-column mt-4 align-items-center">
                  <h2 class="h2">Hello, who's this?</h2>
                  <div class="w-auto h-px bg-black"></div>
                  <div id="memberErrorMessage" style="color: red; display: none;"></div>
              </div>
              <div class="d-flex flex-column gap-2">
                  <label>Name</label>
                  <input id="name-input" type="text" class="border border-gray-100"> 
              </input>
              </div>
              <div class="d-flex flex-column gap-2">
                  <label>Email*</label>
                  <input id="email-input" type="text" class="border border-gray-100"></input>
              </div>
              <div class="d-flex flex-column gap-2">
                  <label>Password*</label>
                  <input id="password-input" type="password" class="border border-gray-100"></input>
              </div>
              <div class="d-flex gap-2 text-sm mb-4">
                  <button id="signup-btn" class="border border-dark text-dark py-1 px-2 bg-light hover:bg-gray-200" style="transition: ease-in-out .2s;" onclick="handleNativeSignup()">Sign up</button>
                  <button id="signin-btn" class="bg-black text-white py-1 px-2 hover:bg-gray-800" style="transition: ease-in-out .2s;" onclick="handleNativeSignin()">Sign in</button>
              </div>
          </div>
    </div>
    <footer class="footer">
      <h6>
        Learn more about <span class="learn-more text-info">Clarity Call.</span>
      </h6>
    </footer>
    <script>

const errorMessage = document.getElementById('memberErrorMessage');

function handleNativeSignup() {
const userName = document.getElementById("name-input").value;
const userEmail = document.getElementById("email-input").value;
const userPassword = document.getElementById("password-input").value;
const params = new URLSearchParams(window.location.search);
const redirectUrl = params.get('redirect');


  fetch("/api/user/signup", {
    method: "POST",
    headers: {
      "content-type": "application/json",
    },
    body: JSON.stringify({
      name: userName,
      email: userEmail,
      password: userPassword,
    }),
  })
    .then(resonse => {
      if (!response.ok) {
        throw response;
      }
      return response.json(); 
    })
    .then((response) => {
      if (resonse.data.access_token) {
        alert(`Welcom, Happy meeting! ${response.user.name}`);
        window.location.href = redirectUrl || '/action.html';
      }
    })
    .catch((err) => {
      if (err instanceof Response) {
        err.json().then((body) => {
        errorMessage.textContent = body.error;
        errorMessage.style.display = "block";
        setTimeout(() => {
          errorMessage.style.display = "none";
        }, 2000);
      });
      } else {
        console.error(err); 
        errorMessage.textContent = 'An error occurred. Please try again.';
    errorMessage.style.display = "block";
    setTimeout(() => {
      errorMessage.style.display = "none";
    }, 2000);
      }
      
    });
}

function handleNativeSignin() {
const userEmail = document.getElementById("email-input").value;
const userPassword = document.getElementById("password-input").value;
const params = new URLSearchParams(window.location.search);
const redirectUrl = params.get('redirect');

  fetch("/api/user/signin", {
    method: "POST",
    headers: {
      "content-type": "application/json",
    },
    body: JSON.stringify({
      email: userEmail,
      password: userPassword,
    }),
  })
    .then(response => {
      if (!response.ok) {
        throw response;
      }
      return response.json(); 
    })
    .then((response) => {
      if (response.data.access_token) {
        alert(`Happy meeting! ${response.data.user.name}`);
        console.log('redirectURL:', redirectUrl);
        window.location.href = redirectUrl ? decodeURIComponent(redirectUrl) : '/action.html';
    }
  })
    .catch((err) => {
      if (err instanceof Response) {
        err.json().then((body) => {
        errorMessage.textContent = body.error;
        errorMessage.style.display = "block";
        setTimeout(() => {
          errorMessage.style.display = "none";
        }, 2000);
      });
      } else {
        console.error(err); 
        errorMessage.textContent = 'An error occurred. Please try again.';
    errorMessage.style.display = "block";
    setTimeout(() => {
      errorMessage.style.display = "none";
    }, 2000);
      }
      
    });
}

    </script>
  </body>
</html>
